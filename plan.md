# ハッカソン計画表

## タイトル
- Virtual-laboratory (仮想研究室)
- virt-lab (仮想研究室)

## 目的


## 要件
- ユーザ認証
- コメント機能
- 投稿機能
- ページ制限機能

# サーバインフラの構築
## 条件
- マシン数：2
- 各マシンにKVM VM：2
    - 計：4ノード

## 構成
- ノード 1：
    - 192.168.122.11/24
    - ansible ターゲットノード
    - **外部からのエントリポイント**
        - ハッキングされてもOKなサーバ
    - リバースプロキシサーバ
        - **nginx** or apache or squid
    - プロキシサーバ
    - k8s ワーカ
        - ゲートウェイを置く
            - nginx, apache, ...
- ノード 2：
    - 192.168.122.12/24
    - **ストレージサーバ**
        - 内部サーバ
        - 管理者がコマンドを打つサーバ
    - ansible コントロールノード
    - LDAP，samba，NFS サーバ
    - k8s マスタ
- ノード 3, 4：
    - 192.168.122.13/24
    - 192.168.122.14/24
    - ansible ターゲット
    - **計算ノード**
        - 内部サーバ
        - 一般ユーザが使えるサーバ
    - LDAP，samba，NFS クライアント
    - k8s ワーカ
        - prometheus
        - grafana
        - gitlab
        - ...
    - LDAP コンシューマ
        - ノード2が落ちたときの緊急LDAPサーバとして使用
## その他
- ファイルはLVM
- ansibleでコード化


## やること
- スライド作り
    - pdf化して，このリポジトリに配置
- branch作成
    - saito
    - taiki

## メモ
### 自作のブリッジを作りたい問題
- KVMが作成するサブネットは 192.168.122.0/24
- このサブネットに配置されているデフォルトブリッジ virbr0(192.168.122.1)は
    デフォルトでインターネットに疎通できる
- ブリッジを任意のサブネットで自作したい !
    - デフォルトゲートウェイと同じ同じサブネットなら いける
        - 例えば 産総研クラスタでは，192.168.2.0/24 のブリッジを作れば外部と疎通できる
    - 問題は，192.168.2.0/24 以外のアドレスをブリッジにふると外部と疎通できなくなること
        - なぜKVNのデフォルトブリッジが，192.168.122.0/24 で外部と疎通できているのか？
        - ルーティングテーブルをいじっている？
        - それとも NATやIPマスカレード？

## 今後の予定
- 外部に公開するWEBサーバを構築する
    - スライドの最後に追加
- ブリッジの設定は最後
    - 出来なかったら今後の予定として発表